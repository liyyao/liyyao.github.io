<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>阿里云nacos集群部署</title>
    <url>/2020/08/29/%E9%98%BF%E9%87%8C%E4%BA%91%E9%83%A8%E7%BD%B2nacos%E9%9B%86%E7%BE%A4/</url>
    <content><![CDATA[<h2 id="1-准备4台linux服务器"><a href="#1-准备4台linux服务器" class="headerlink" title="1. 准备4台linux服务器"></a>1. 准备4台linux服务器</h2><ul>
<li>准备阿里云服务器4台，3台用做nacos集群，1台用做mysql数据库</li>
<li>配置阿里云服务器网络安全组，打开入网端口</li>
</ul>
<h2 id="2-安装mysql"><a href="#2-安装mysql" class="headerlink" title="2. 安装mysql"></a>2. 安装mysql</h2><h3 id="（1）下载并安装MySQL官方的Yum-Repository-Mysql版本-5-7-14"><a href="#（1）下载并安装MySQL官方的Yum-Repository-Mysql版本-5-7-14" class="headerlink" title="（1）下载并安装MySQL官方的Yum Repository, Mysql版本 5.7.14"></a>（1）下载并安装MySQL官方的Yum Repository, Mysql版本 5.7.14</h3><pre><code># wget -i -c https://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm
# yum -y install mysql57-community-release-el7-10.noarch.rpm</code></pre>
<h3 id="（2）安装MySQL-服务器"><a href="#（2）安装MySQL-服务器" class="headerlink" title="（2）安装MySQL 服务器"></a>（2）安装MySQL 服务器</h3><pre><code># yum -y install mysql-community-server</code></pre>
<h3 id="（3）MySQL数据库设置"><a href="#（3）MySQL数据库设置" class="headerlink" title="（3）MySQL数据库设置"></a>（3）MySQL数据库设置</h3><ul>
<li><p>首先启动MySQL  </p>
<blockquote>
<p> # systemctl start mysqld.service</p>
</blockquote>
</li>
<li><p>查看MySQL运行状态</p>
<blockquote>
<p> # systemctl status mysqld.service</p>
</blockquote>
</li>
<li><p>找root用户密码</p>
<blockquote>
<p> # grep “password” /var/log/mysqld.log</p>
</blockquote>
</li>
<li><p>进入数据库</p>
<blockquote>
<p> # mysql -uroot -p</p>
</blockquote>
</li>
<li><p>修改数据库密码</p>
<blockquote>
<p>mysql&gt; SET PASSWORD = PASSWORD(‘12345678’);<br>mysql&gt; ALTER USER ‘root’@’localhost’ PASSWORD EXPIRE NEVER;<br>mysql&gt; FLUSH PRIVILEGES;</p>
</blockquote>
</li>
<li><p>重新登录数据库，设置远程连接</p>
<blockquote>
<p>mysql&gt; use mysql;<br>mysql&gt; update user set host = ‘%’ where user = ‘root’;<br>mysql&gt; FLUSH PRIVILEGES;</p>
</blockquote>
</li>
<li><p>进行远程连接测试</p>
</li>
<li><p>为firewalld添加开放端口</p>
<blockquote>
<p>添加mysql端口3306<br> # firewall-cmd –zone=public –add-port=3306/tcp –permanent<br> # firewall-cmd –reload</p>
</blockquote>
</li>
<li><p>更改mysql语言</p>
<blockquote>
<p> 首先重新登录mysql,然后输入status,可以看到Server characterset: latinl，不是utf-8;<br> 出mysql, vi /etc/my.cnf新增4行代码<br> [client]<br> default-character-set=utf8<br> character-set-server=utf8<br> collation-server=utf8_general_ci<br> 保存成功后，重启mysql,然后输入status就会发现变化了</p>
</blockquote>
</li>
</ul>
<h2 id="3-安装Nacos"><a href="#3-安装Nacos" class="headerlink" title="3. 安装Nacos"></a>3. 安装Nacos</h2><h3 id="（1）准备3台服务器作naco集群"><a href="#（1）准备3台服务器作naco集群" class="headerlink" title="（1）准备3台服务器作naco集群"></a>（1）准备3台服务器作naco集群</h3><blockquote>
<p>配置hosts<br># vi /etc/hosts<br>配置本机的hostname到ip地址的映射</p>
</blockquote>
<h3 id="（2）安装JDK"><a href="#（2）安装JDK" class="headerlink" title="（2）安装JDK"></a>（2）安装JDK</h3><blockquote>
<p>上传jdk，然后安装  # rpm -ivh jdk-xxx.rpm<br>配置jdk相关环境变量 # vi /etc/bashrc<br>export JAVA_HOME=/usr/java/xxx<br>export PATH=$PATH:$JAVA_HOME/bin<br>source /etc/bashrc<br>测试jdc安装是否成功：java -version</p>
</blockquote>
<h3 id="（3）下载nacos-server-1-4版本的源码"><a href="#（3）下载nacos-server-1-4版本的源码" class="headerlink" title="（3）下载nacos-server-1.4版本的源码"></a>（3）下载nacos-server-1.4版本的源码</h3><pre><code># git clone https://github.com/alibaba/nacos.git
# cd nacos
# mvn -Prelease-nacos -Dmaven.test.skip=true clean install -U
# ls -al distribution/target/</code></pre>
<h3 id="（4）-nacos上传到服务器上"><a href="#（4）-nacos上传到服务器上" class="headerlink" title="（4） nacos上传到服务器上"></a>（4） nacos上传到服务器上</h3><pre><code>win命令可以用 scp xxx root@192.168.xxx.xxx:/usr/local/xxx 进行上传</code></pre>
<h3 id="（5）配置nacos"><a href="#（5）配置nacos" class="headerlink" title="（5）配置nacos"></a>（5）配置nacos</h3><ul>
<li>解压nacos  <ul>
<li>重命名 cluster.conf.example, 去掉 example: mv cluster.conf.example cluster.conf, 配置三台机器的地址和端口号，默认端口号是8848  </li>
<li>配置数据库    <blockquote>
<p>修改application.properties文件里面数据库配置<br>spring.datasource.platform=mysql<br>db.num=1<br>db.url.0=xx, 替换成mysql数据库端口号及数据库<br>db.user=xx<br>db.password=xx</p>
</blockquote>
</li>
<li>打开8848端口<blockquote>
<p>开启防火墙  # systemctl start firewalld<br>开放指定端口  # firewall-cmd –zone=public –add-port=8848/tcp –permanent<br>重启防火墙  # firewall-cmd –reload</p>
</blockquote>
</li>
</ul>
</li>
<li>mysql导入nacos相关数据库表  <ul>
<li>在下载的nacos源码里nacos\distribution\conf下有nacos-mysql.sql文件 </li>
</ul>
</li>
<li>启动<ul>
<li>分别进行三台机器的bin目录下，执行startup.sh，检查logs目录下的start.out启动日志</li>
<li>启动时如果startup.sh无法启动，可能是因为文件格式不对，需要修改文件格式  <blockquote>
<p> # vi startup.sh<br> :set fileformat=unix<br> :wq</p>
</blockquote>
</li>
</ul>
</li>
<li>访问nacos  <ul>
<li>在浏览器地址栏输入nacos集群中的一个ip地址，192.168.xxx.xxx:8848/nacos/index.html即可跳转到nacos登录页面，默认用户名和密码都是nacos，登录成功后可看到nacos相关信息。</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>SpringCloud</category>
        <category>nacos</category>
      </categories>
  </entry>
</search>
