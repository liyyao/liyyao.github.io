<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>阿里云nacos集群部署</title>
      <link href="/2020/08/29/nacos%E5%AE%89%E8%A3%85/"/>
      <url>/2020/08/29/nacos%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<p>##1. 准备4台linux服务器</p><ul><li>准备阿里云服务器4台，3台用做nacos集群，1台用做mysql数据库</li><li>配置阿里云服务器网络安全组，打开入网端口</li></ul><p>##2. 安装mysql<br>###（1）下载并安装MySQL官方的Yum Repository, Mysql版本 5.7.14<br>    # wget -i -c <a href="https://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm">https://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm</a><br>    # yum -y install mysql57-community-release-el7-10.noarch.rpm</p><p>###（2）安装MySQL 服务器<br>    # yum -y install mysql-community-server</p><p>###（3）MySQL数据库设置</p><ul><li><p>首先启动MySQL</p><blockquote><h1 id="systemctl-start-mysqld-service"><a href="#systemctl-start-mysqld-service" class="headerlink" title="systemctl start mysqld.service"></a>systemctl start mysqld.service</h1></blockquote></li><li><p>查看MySQL运行状态</p><blockquote><h1 id="systemctl-status-mysqld-service"><a href="#systemctl-status-mysqld-service" class="headerlink" title="systemctl status mysqld.service"></a>systemctl status mysqld.service</h1></blockquote></li><li><p>找root用户密码</p><blockquote><h1 id="grep-“password”-var-log-mysqld-log"><a href="#grep-“password”-var-log-mysqld-log" class="headerlink" title="grep “password” /var/log/mysqld.log"></a>grep “password” /var/log/mysqld.log</h1></blockquote></li><li><p>进入数据库</p><blockquote><h1 id="mysql-uroot-p"><a href="#mysql-uroot-p" class="headerlink" title="mysql -uroot -p"></a>mysql -uroot -p</h1></blockquote></li><li><p>修改数据库密码</p><blockquote><p>mysql&gt; SET PASSWORD = PASSWORD(‘12345678’);<br>mysql&gt; ALTER USER ‘root’@’localhost’ PASSWORD EXPIRE NEVER;<br>mysql&gt; FLUSH PRIVILEGES;</p></blockquote></li><li><p>重新登录数据库，设置远程连接</p><blockquote><p>mysql&gt; use mysql;<br>mysql&gt; update user set host = ‘%’ where user = ‘root’;<br>mysql&gt; FLUSH PRIVILEGES;</p></blockquote></li><li><p>进行远程连接测试</p></li><li><p>为firewalld添加开放端口</p><blockquote><p>添加mysql端口3306</p><h1 id="firewall-cmd-–zone-public-–add-port-3306-tcp-–permanent"><a href="#firewall-cmd-–zone-public-–add-port-3306-tcp-–permanent" class="headerlink" title="firewall-cmd –zone=public –add-port=3306/tcp –permanent"></a>firewall-cmd –zone=public –add-port=3306/tcp –permanent</h1><h1 id="firewall-cmd-–reload"><a href="#firewall-cmd-–reload" class="headerlink" title="firewall-cmd –reload"></a>firewall-cmd –reload</h1></blockquote></li><li><p>更改mysql语言</p><blockquote><p> 首先重新登录mysql,然后输入status,可以看到Server characterset: latinl，不是utf-8;<br> 出mysql, vi /etc/my.cnf新增4行代码<br> [client]<br> default-character-set=utf8<br> character-set-server=utf8<br> collation-server=utf8_general_ci<br> 保存成功后，重启mysql,然后输入status就会发现变化了</p></blockquote></li></ul><p>##3. 安装Nacos<br>###（1）准备3台服务器作naco集群</p><blockquote><p>配置hosts  </p><h1 id="vi-etc-hosts"><a href="#vi-etc-hosts" class="headerlink" title="vi /etc/hosts"></a>vi /etc/hosts</h1><p>配置本机的hostname到ip地址的映射</p></blockquote><p>###（2）安装JDK</p><blockquote><p>上传jdk,然后安装  # rpm -ivh jdk-xxx.rpm<br>配置jdk相关环境变量 # vi /etc/bashrc<br>export JAVA_HOME=/usr/java/xxx<br>export PATH=$PATH:$JAVA_HOME/bin<br>source /etc/bashrc<br>测试jdc安装是否成功：java -version</p></blockquote><p>###（3）下载nacos-server-1.4版本的源码<br>    # git clone <a href="https://github.com/alibaba/nacos.git">https://github.com/alibaba/nacos.git</a><br>    # cd nacos<br>    # mvn -Prelease-nacos -Dmaven.test.skip=true clean install -U<br>    # ls -al distribution/target/<br>###（4） nacos上传到服务器上<br>    win命令可以用 scp xxx <a href="mailto:&#x72;&#x6f;&#111;&#116;&#x40;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#120;&#120;&#120;&#46;&#x78;&#120;&#120;">&#x72;&#x6f;&#111;&#116;&#x40;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#120;&#120;&#120;&#46;&#x78;&#120;&#120;</a>:/usr/local/xxx 进行上传<br>###（5）配置nacos</p><ul><li>解压nacos  <ul><li>重命名 cluster.conf.example, 去掉 example: mv cluster.conf.example cluster.conf, 配置三台机器的地址和端口号，默认端口号是8848  </li><li>配置数据库    <blockquote><p>修改application.properties文件里面数据库配置<br>spring.datasource.platform=mysql<br>db.num=1<br>db.url.0=xx, 替换成mysql数据库端口号及数据库<br>db.user=xx<br>db.password=xx</p></blockquote></li><li>打开8848端口<blockquote><p>开启防火墙  # systemctl start firewalld<br>开放指定端口  # firewall-cmd –zone=public –add-port=8848/tcp –permanent<br>重启防火墙  # firewall-cmd –reload</p></blockquote></li></ul></li><li>mysql导入nacos相关数据库表  <ul><li>在下载的nacos源码里nacos\distribution\conf下有nacos-mysql.sql文件 </li></ul></li><li>启动<ul><li>分别进行三台机器的bin目录下，执行startup.sh，检查logs目录下的start.out启动日志</li><li>启动时如果startup.sh无法启动，可能是因为文件格式不对，需要修改文件格式  <blockquote><h1 id="vi-startup-sh"><a href="#vi-startup-sh" class="headerlink" title="vi startup.sh"></a>vi startup.sh</h1><p> :set fileformat=unix<br> :wq</p></blockquote></li></ul></li><li>访问nacos  <ul><li>在浏览器地址栏输入nacos集群中的一个ip地址，192.168.xxx.xxx:8848/nacos/index.html即可跳转到nacos登录页面，默认用户名和密码都是nacos，登录成功后可看到nacos相关信息。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> SpringCloud nacos </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
